<!DOCTYPE html>
<html>
<head>
  <title>Book Seats</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #0c0b0b; }
    .seat { display: inline-block; width: 40px; height: 40px; margin: 5px; background: #ccc; text-align: center; line-height: 40px; cursor: pointer; border-radius: 4px; }
    .seat.selected { background: #41d973; color: #0c0b0b; }
    button { margin-top: 20px; padding: 10px 20px; background: #d0082c; color: white; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <h2 id="movieTitle" style="color:#a98b8b">Booking for: </h2>
  <div id="seatContainer"></div>
  <button onclick="confirmBooking()">Confirm Booking</button>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const movie = urlParams.get('movie');
    document.getElementById('movieTitle').textContent += movie;

    const seatContainer = document.getElementById('seatContainer');
    const selectedSeats = [];
    let j=1;
    let k=1;
    let l=1;
    for (let i = 1; i <= 116; i++) {
      const seat = document.createElement('div');
      seat.className = 'seat';
      if(i<=29){
      seat.textContent = 'A' + i;
      }
      if(i<=58 && i>29){
        seat.textContent = 'B' + j;
        j++;
      }
      if(i<=87 && i>58){
        seat.textContent = 'C' + k;
        k++;
      }
      if(i<=116 && i>87){
        seat.textContent = 'D' + le;
        l++;
      }
      seat.onclick = () => {
        seat.classList.toggle('selected');
        const seatId = seat.textContent;
        if (selectedSeats.includes(seatId)) {
          selectedSeats.splice(selectedSeats.indexOf(seatId), 1);
        } else {
          selectedSeats.push(seatId);
        }
      };
      seatContainer.appendChild(seat);
    }

    function confirmBooking() {
      if (selectedSeats.length === 0) {
        alert('Please select at least one seat');
        return;
      }

      fetch('/api/bookings', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + localStorage.getItem('token')
        },
        body: JSON.stringify({
          movie,
          seat: selectedSeats[0] // booking one seat for now
        })
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message || 'Booking confirmed');
        window.location.href = '/bookings.html';
      })
      .catch(err => {
        console.error('Booking error:', err);
        alert('Booking failed');
      });
    }
    function cancelBooking(bookingId) {
  if (!confirm("Are you sure you want to cancel this ticket?")) return;

  fetch(`/api/bookings/${bookingId}`, {
    method: 'DELETE',
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  })
  .then(res => {
    if (res.ok) {
      alert("Booking cancelled successfully.");
      location.reload(); // Refresh to update UI
    } else {
      alert("Failed to cancel booking.");
    }
  })
  .catch(err => {
    console.error("Error cancelling booking:", err);
    alert("Something went wrong.");
  });
}
  </script>
</body>
</html>